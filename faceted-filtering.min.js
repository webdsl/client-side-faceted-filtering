function updateFacets(){hidableElems||(hidableElems=$(".hidable"),facetPlaceholderElems=$(".facet-placeholder"),initSelectionFromUrl()),facetPlaceholderElems.each(function(){var e=$(this),t=e.attr("data-selected-facets"),a="undefined"!=typeof t&&t.length>0,l=e.data("facet-type"),i="data-facet-"+l,c=facetRetrievalClasses(l),n=$(c+" ["+i+"]"),r=n.map(function(){return this.getAttribute(i+"-order")+"%%"+this.getAttribute(i)});if(valArraySorted=$(r.sort()).map(function(){return this.replace(/([^%]*%%)?(.*)/,"$2")}),a){var n=$(t.split("%%%%")).map(function(){return this.replace(/%%/g,"")});$.merge(valArraySorted,n)}var s=$(unique(valArraySorted)).map(function(){if(this.length<1)return"";var e="%%"+this+"%%",l=facetButtonClass+" facet-"+(a&&t.indexOf(e)>-1);return'<div class="'+l+'">'+this+"</div>"}),o=s.get().join("");o.length<1&&(o='<span class="no-facets">Nothing to filter</span>'),$(this).html(o),$(this).children().click(toggleFacet)})}function facetRetrievalClasses(e){var t=facetPlaceholderElems.filter('[data-selected-facets*="%%"][data-facet-type!="'+e+'"]'),a=t.map(function(){return".facet-selected-"+$(this).data("facet-type")});return"*"+a.get().join("")}function unique(e){return $.grep(e,function(t,a){return a===$.inArray(t,e)})}function initSelectionFromUrl(){var e=window.location.search;e.length&&(facetPlaceholderElems.each(function(){var t=$(this).data("facet-type"),a=encodeURIComponent(t),l=new RegExp("(&|\\?)"+a+"=([^&]*)");if(match=l.exec(e),null!=match){var i=decodeURIComponent(match[2]),c="%%"+i.split(",").join("%%%%")+"%%";$(this).attr("data-selected-facets",c)}}),filterFacets())}function toggleFacet(e){var t=e.currentTarget.innerHTML,a=$(e.currentTarget).parent(".facet-placeholder"),l=(a.data("facet-type"),a.attr("data-selected-facets")),i="%%"+t+"%%";if(l||(l=""),l.indexOf(i)>-1)a.attr("data-selected-facets",l.replace(i,""));else{var c=l+i;a.attr("data-selected-facets",c)}filterFacets(),updateFacets()}function filterFacets(){var e=document.location.search,t="*";if(facetPlaceholderElems.filter("[data-selected-facets]").each(function(){var a=$(this).data("facet-type"),l="data-facet-"+a,i=/%%([^%]+)%%/g,c=$(this).attr("data-selected-facets");match=i.exec(c);var n=[],r=[];if(c.length>0)for(;null!=match;)r.push(match[1]),n.push("["+l+'="'+match[1]+'"]'),match=i.exec(c);e=insertParam2(e,a,r.join(","));var s="facet-selected-"+a;if(hidableElems.removeClass(s),n.length){var o=n.join(","),d=$(o);d.closest(".hidable").addClass(s),d.find(".hidable:not(:has(.hidable))").addClass(s),t+="."+s}}),e!=document.location.search){var a=window.location.protocol+"//"+window.location.host+window.location.pathname+e+window.location.hash;history.replaceState(null,document.title+" - filtered",a)}hidableElems.attr("data-is-visible",!1),console.log("class selector:"+t),"*"!=t?hidableElems.filter(t).attr("data-is-visible",!0).parents(".hidable").attr("data-is-visible",!0):hidableElems.filter(t).attr("data-is-visible",!0),hidableElems.filter("[data-is-visible!=true]").hide(),hidableElems.filter("[data-is-visible=true]").show()}function insertParam2(e,t,a){t=encodeURIComponent(t),a=encodeURIComponent(a);var l=e.length?e.substring(1,e.length):"",i=a.length?t+"="+a:"",c=new RegExp("(^|&)"+t+"=[^&]*");return l=i.length?l.replace(c,"$1"+i):l.replace(c,""),i.length&&l.indexOf(i)<0&&(l+=(l.length>0?"&":"")+i),"?"+l}var hidableElems,facetPlaceholderElems,facetButtonClass="btn-xs btn btn-default";$("document").ready(updateFacets);
